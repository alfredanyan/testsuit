<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Closures</title>

    <script>
      var script = document.createElement("script");
      script.src = "https://code.jquery.com/jquery-3.4.1.min.js";
      script.type = "text/javascript";
      document.getElementsByTagName("head")[0].appendChild(script);


      function assert(value, comment) {
        var li = document.createElement("li");
        li.className = value ? "pass" : "fail";
        li.appendChild(document.createTextNode(comment));
        document.getElementById("results").appendChild(li);
      }

      //using closure to approximate private variables
      function Ninja() {
        var feint = 0;

        this.getFeint = function () {
          return feint;
        };
        this.increaseFeint = function () {
          feint++;
        };
      }

      function testUrl() {
        console.log("testing");
        var elem$ = $("#testSubject");
        elem$.html("Loading...");
        $.ajax({
          url: "test.html",
          success: function (html) {
            assert(
              elem$,
              "we can see elem$, via the closure for this callback."
            );
            elem$.html(html);
          },
        });
      }

      window.onload = function () {
        var ninja = new Ninja();
        ninja.increaseFeint();
        assert(ninja.getFeint() == 1, "indirect access to feint count");
        assert(ninja.feint === undefined, "no direct access to feint");

        //closure template setup
        var outerValue = "ninja";
        var later;

        function outerFunction() {
          var innerValue = "samurai";
          function innerFunction(paramValue) {
            assert(outerValue == "ninja", "ninja is visible to Inner");
            assert(innerValue, "Inner can see the samurai");
            assert(paramValue, "inner can see the wakizashi");
            assert(tooLate, "Inner can see the ronin");
          }
          later = innerFunction;
        }
        assert(!tooLate, "outer cant see the ronin");
        var tooLate = "ronin";
        outerFunction();
        later("wakizashi");
      };
    </script>

    <style>
      #results li.pass {
        color: green;
      }
      #results li.fail {
        color: red;
        text-decoration: line-through;
      }
    </style>
  </head>
  <body>
    <ul id="results"></ul>
    <div id="testSubject"></div>
    <button type="button" id="testButton" onclick="testUrl()">Go!</button>
  </body>
</html>
